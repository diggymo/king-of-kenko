# TODOアプリケーションについて

## 言語/FWの選定

言語にはTypeScriptを採用しました。
また、フレームワークにはNest.jsを採用しました。TypeScriptで記述ができるフレームワークはExpress, Nest.js, Next.jsなどが考えられますが、バックエンドのロジックに集中することができる点、主要な機能が公式に提供されている点、機能ごとにモジュール分割しやすい点を加味してNest.jsを選択しました。

## データ永続化方法の検討

データを永続化するためにRDBを選択しました。また、RDBとしてPostgresQLを選択しました。

また、アプリケーションからPostgresQLへアクセスするORMとしてPrismaを採用しました。TypeORMやSequelizeなど他にもORMがありますが、エンティティがシンプルなオブジェクトであり学習コストが低く、また型が強力に設定されていてエラーを事前に防げる点を加味してPrismaを選択しました。

## TODOアプリケーションの構成


TODOアプリケーションは、複数のモジュールから構成されています。主なモジュールは以下の通りです。

- auth（認証・認可関連）
- prisma（データベースアクセス関連）
- todo（TODO関連）
- user（ユーザー関連）

技術的な関心で分割するのではなくモジュールごとに分割することで、特定の機能を追加開発する際に関連するファイル同士の距離を近くすることができます。  
また、依存する外部のモジュールのことを気にせず開発やテストの実装をすることができます。  
また、将来的にアプリケーションの規模が大きくなった際にモジュールを分割してマイクロサービスに移行しやすいとも考えています。

各モジュールの中身は、主に`controller`と`service`の2つのレイヤーから構成されています。  
`dto`/`exception-filter`/`guards`/`decorator`/`controller`は`controller`のレイヤに属しており、`entity`/`service`は`service`のレイヤに属していると考えています。
`controller`レイヤは、HTTPに関する外部とのやりとりの責任を担うレイヤです。したがってリクエストボディのバリデーションやURL構成やエラーのレスポンス変換もこのクラスで行います。  
また、`service`レイヤはアプリケーションのユースケースやドメインの振る舞いを表現するクラスです。ビジネスロジックによるバリデーションやデータベースとの連携はここで行います  
今回の仕様上、`repository`というレイヤは不要と考えており作成していません。`repository`レイヤは本来データベースとの連携の責務を持ちますが、今回は`service`レイヤに持たせています。  
というのも、今回の仕様複雑ではなくアプリケーションのユースケースやドメインの振る舞いが少なかったためです。もし各ドメインの複雑さが将来的に上がる場合はrepositoryを設けなければならないと考えています。

## エラーハンドリングについて

ビジネスロジックのバリデーションによってエラーが発生することがあります。その場合は`service`レイヤでエラーを発生させ、そのエラーを`controller`レイヤの`controller`もしくは`exception-filter`（Nest.jsが提供するExceptionFilter）でキャッチする仕組みを理想だと考えています。  
ですが、今回の場合だとエラーのパターンが少ないため、グローバルなExceptionFilterで一括してエラーハンドリングをしています。ビジネスロジックのバリデーションが増えてきたら、各モジュールの`exception-filter`もしくは`controller`でハンドリングすることを考えます。

